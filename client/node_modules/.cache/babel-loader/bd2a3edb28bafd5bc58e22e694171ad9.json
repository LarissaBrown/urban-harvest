{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = require(\"react\");\n\nvar react_dom_1 = require(\"react-dom\");\n\nvar use_ssr_1 = __importDefault(require(\"use-ssr\"));\n\nexports.errorMessage1 = 'You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e).';\n\nfunction usePortal(_a) {\n  if (_a === void 0) {\n    _a = {};\n  }\n\n  var _b = _a.closeOnOutsideClick,\n      closeOnOutsideClick = _b === void 0 ? true : _b,\n      _c = _a.closeOnEsc,\n      closeOnEsc = _c === void 0 ? true : _c,\n      bindTo = _a.bindTo,\n      // attach the portal to this node in the DOM\n  _d = _a.isOpen,\n      // attach the portal to this node in the DOM\n  defaultIsOpen = _d === void 0 ? false : _d,\n      onOpen = _a.onOpen,\n      onClose = _a.onClose,\n      onPortalClick = _a.onPortalClick,\n      eventHandlers = __rest(_a, [\"closeOnOutsideClick\", \"closeOnEsc\", \"bindTo\", \"isOpen\", \"onOpen\", \"onClose\", \"onPortalClick\"]);\n\n  var _e = use_ssr_1.default(),\n      isServer = _e.isServer,\n      isBrowser = _e.isBrowser;\n\n  var _f = react_1.useState(defaultIsOpen),\n      isOpen = _f[0],\n      makeOpen = _f[1]; // we use this ref because `isOpen` is stale for handleOutsideMouseClick\n\n\n  var open = react_1.useRef(isOpen);\n  var setOpen = react_1.useCallback(function (v) {\n    // workaround to not have stale `isOpen` in the handleOutsideMouseClick\n    open.current = v;\n    makeOpen(v);\n  }, []);\n  var targetEl = react_1.useRef(); // this is the element you are clicking/hovering/whatever, to trigger opening the portal\n\n  var portal = react_1.useRef(isBrowser ? document.createElement('div') : null);\n  react_1.useEffect(function () {\n    if (isBrowser && !portal.current) portal.current = document.createElement('div');\n  }, [isBrowser, portal]);\n  var elToMountTo = react_1.useMemo(function () {\n    if (isServer) return;\n    return bindTo && react_dom_1.findDOMNode(bindTo) || document.body;\n  }, [isServer, bindTo]);\n\n  var createCustomEvent = function (e) {\n    if (!e) return {\n      portal: portal,\n      targetEl: targetEl,\n      event: e\n    };\n    var event = e || {};\n    if (event.persist) event.persist();\n    event.portal = portal;\n    event.targetEl = targetEl;\n    event.event = e;\n    var currentTarget = e.currentTarget;\n    if (!targetEl.current && currentTarget && currentTarget !== document) targetEl.current = event.currentTarget;\n    return event;\n  }; // this should handle all eventHandlers like onClick, onMouseOver, etc. passed into the config\n\n\n  var customEventHandlers = Object.entries(eventHandlers).reduce(function (acc, _a) {\n    var handlerName = _a[0],\n        eventHandler = _a[1];\n\n    acc[handlerName] = function (event) {\n      if (isServer) return;\n      eventHandler(createCustomEvent(event));\n    };\n\n    return acc;\n  }, {});\n  var openPortal = react_1.useCallback(function (e) {\n    if (isServer) return;\n    var customEvent = createCustomEvent(e); // for some reason, when we don't have the event argument, there\n    // is a weird race condition. Would like to see if we can remove\n    // setTimeout, but for now this works\n\n    if (targetEl.current == null) {\n      setTimeout(function () {\n        return setOpen(true);\n      }, 0);\n      throw Error(exports.errorMessage1);\n    }\n\n    if (onOpen) onOpen(customEvent);\n    setOpen(true);\n  }, [isServer, portal, setOpen, targetEl, onOpen]);\n  var closePortal = react_1.useCallback(function (e) {\n    if (isServer) return;\n    var customEvent = createCustomEvent(e);\n    if (onClose && open.current) onClose(customEvent);\n    if (open.current) setOpen(false);\n  }, [isServer, onClose, setOpen]);\n  var togglePortal = react_1.useCallback(function (e) {\n    return open.current ? closePortal(e) : openPortal(e);\n  }, [closePortal, openPortal]);\n  var handleKeydown = react_1.useCallback(function (e) {\n    return e.key === 'Escape' && closeOnEsc ? closePortal(e) : undefined;\n  }, [closeOnEsc, closePortal]);\n  var handleOutsideMouseClick = react_1.useCallback(function (e) {\n    var containsTarget = function (target) {\n      return target.current.contains(e.target);\n    };\n\n    if (containsTarget(portal) || e.button !== 0 || !open.current || containsTarget(targetEl)) return;\n    if (closeOnOutsideClick) closePortal(e);\n  }, [isServer, closePortal, closeOnOutsideClick, portal]);\n  var handleMouseDown = react_1.useCallback(function (e) {\n    if (isServer || !(portal.current instanceof HTMLElement)) return;\n    var customEvent = createCustomEvent(e);\n    if (portal.current.contains(customEvent.target) && onPortalClick) onPortalClick(customEvent);\n    handleOutsideMouseClick(e);\n  }, [handleOutsideMouseClick]); // used to remove the event listeners on unmount\n\n  var eventListeners = react_1.useRef({});\n  react_1.useEffect(function () {\n    if (isServer) return;\n    if (!(elToMountTo instanceof HTMLElement) || !(portal.current instanceof HTMLElement)) return; // TODO: eventually will need to figure out a better solution for this.\n    // Surely we can find a way to map onScroll/onWheel -> scroll/wheel better,\n    // but for all other event handlers. For now this works.\n\n    var eventHandlerMap = {\n      onScroll: 'scroll',\n      onWheel: 'wheel'\n    };\n    var node = portal.current;\n    elToMountTo.appendChild(portal.current); // handles all special case handlers. Currently only onScroll and onWheel\n\n    Object.entries(eventHandlerMap).forEach(function (_a) {\n      var handlerName = _a[0]\n      /* onScroll */\n      ,\n          eventListenerName = _a[1]\n      /* scroll */\n      ;\n      if (!eventHandlers[handlerName]) return;\n\n      eventListeners.current[handlerName] = function (e) {\n        return eventHandlers[handlerName](createCustomEvent(e));\n      };\n\n      document.addEventListener(eventListenerName, eventListeners.current[handlerName]);\n    });\n    document.addEventListener('keydown', handleKeydown);\n    document.addEventListener('mousedown', handleMouseDown);\n    return function () {\n      // handles all special case handlers. Currently only onScroll and onWheel\n      Object.entries(eventHandlerMap).forEach(function (_a) {\n        var handlerName = _a[0],\n            eventListenerName = _a[1];\n        if (!eventHandlers[handlerName]) return;\n        document.removeEventListener(eventListenerName, eventListeners.current[handlerName]);\n        delete eventListeners.current[handlerName];\n      });\n      document.removeEventListener('keydown', handleKeydown);\n      document.removeEventListener('mousedown', handleMouseDown);\n      elToMountTo.removeChild(node);\n    };\n  }, [isServer, handleOutsideMouseClick, handleKeydown, elToMountTo, portal]);\n  var Portal = react_1.useCallback(function (_a) {\n    var children = _a.children;\n    if (portal.current != null) return react_dom_1.createPortal(children, portal.current);\n    return null;\n  }, [portal]);\n  return Object.assign([openPortal, closePortal, open.current, Portal, togglePortal, targetEl, portal], __assign(__assign({\n    isOpen: open.current,\n    openPortal: openPortal,\n    ref: targetEl,\n    closePortal: closePortal,\n    togglePortal: togglePortal,\n    Portal: Portal,\n    portalRef: portal\n  }, customEventHandlers), {\n    bind: __assign({\n      ref: targetEl\n    }, customEventHandlers)\n  }));\n}\n\nexports.default = usePortal;","map":{"version":3,"sources":["../usePortal.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = require(\"react\");\nvar react_dom_1 = require(\"react-dom\");\nvar use_ssr_1 = __importDefault(require(\"use-ssr\"));\nexports.errorMessage1 = 'You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e).';\nfunction usePortal(_a) {\n    if (_a === void 0) { _a = {}; }\n    var _b = _a.closeOnOutsideClick, closeOnOutsideClick = _b === void 0 ? true : _b, _c = _a.closeOnEsc, closeOnEsc = _c === void 0 ? true : _c, bindTo = _a.bindTo, // attach the portal to this node in the DOM\n    _d = _a.isOpen, // attach the portal to this node in the DOM\n    defaultIsOpen = _d === void 0 ? false : _d, onOpen = _a.onOpen, onClose = _a.onClose, onPortalClick = _a.onPortalClick, eventHandlers = __rest(_a, [\"closeOnOutsideClick\", \"closeOnEsc\", \"bindTo\", \"isOpen\", \"onOpen\", \"onClose\", \"onPortalClick\"]);\n    var _e = use_ssr_1.default(), isServer = _e.isServer, isBrowser = _e.isBrowser;\n    var _f = react_1.useState(defaultIsOpen), isOpen = _f[0], makeOpen = _f[1];\n    // we use this ref because `isOpen` is stale for handleOutsideMouseClick\n    var open = react_1.useRef(isOpen);\n    var setOpen = react_1.useCallback(function (v) {\n        // workaround to not have stale `isOpen` in the handleOutsideMouseClick\n        open.current = v;\n        makeOpen(v);\n    }, []);\n    var targetEl = react_1.useRef(); // this is the element you are clicking/hovering/whatever, to trigger opening the portal\n    var portal = react_1.useRef(isBrowser ? document.createElement('div') : null);\n    react_1.useEffect(function () {\n        if (isBrowser && !portal.current)\n            portal.current = document.createElement('div');\n    }, [isBrowser, portal]);\n    var elToMountTo = react_1.useMemo(function () {\n        if (isServer)\n            return;\n        return (bindTo && react_dom_1.findDOMNode(bindTo)) || document.body;\n    }, [isServer, bindTo]);\n    var createCustomEvent = function (e) {\n        if (!e)\n            return { portal: portal, targetEl: targetEl, event: e };\n        var event = e || {};\n        if (event.persist)\n            event.persist();\n        event.portal = portal;\n        event.targetEl = targetEl;\n        event.event = e;\n        var currentTarget = e.currentTarget;\n        if (!targetEl.current && currentTarget && currentTarget !== document)\n            targetEl.current = event.currentTarget;\n        return event;\n    };\n    // this should handle all eventHandlers like onClick, onMouseOver, etc. passed into the config\n    var customEventHandlers = Object\n        .entries(eventHandlers)\n        .reduce(function (acc, _a) {\n        var handlerName = _a[0], eventHandler = _a[1];\n        acc[handlerName] = function (event) {\n            if (isServer)\n                return;\n            eventHandler(createCustomEvent(event));\n        };\n        return acc;\n    }, {});\n    var openPortal = react_1.useCallback(function (e) {\n        if (isServer)\n            return;\n        var customEvent = createCustomEvent(e);\n        // for some reason, when we don't have the event argument, there\n        // is a weird race condition. Would like to see if we can remove\n        // setTimeout, but for now this works\n        if (targetEl.current == null) {\n            setTimeout(function () { return setOpen(true); }, 0);\n            throw Error(exports.errorMessage1);\n        }\n        if (onOpen)\n            onOpen(customEvent);\n        setOpen(true);\n    }, [isServer, portal, setOpen, targetEl, onOpen]);\n    var closePortal = react_1.useCallback(function (e) {\n        if (isServer)\n            return;\n        var customEvent = createCustomEvent(e);\n        if (onClose && open.current)\n            onClose(customEvent);\n        if (open.current)\n            setOpen(false);\n    }, [isServer, onClose, setOpen]);\n    var togglePortal = react_1.useCallback(function (e) {\n        return open.current ? closePortal(e) : openPortal(e);\n    }, [closePortal, openPortal]);\n    var handleKeydown = react_1.useCallback(function (e) {\n        return (e.key === 'Escape' && closeOnEsc) ? closePortal(e) : undefined;\n    }, [closeOnEsc, closePortal]);\n    var handleOutsideMouseClick = react_1.useCallback(function (e) {\n        var containsTarget = function (target) { return target.current.contains(e.target); };\n        if (containsTarget(portal) || e.button !== 0 || !open.current || containsTarget(targetEl))\n            return;\n        if (closeOnOutsideClick)\n            closePortal(e);\n    }, [isServer, closePortal, closeOnOutsideClick, portal]);\n    var handleMouseDown = react_1.useCallback(function (e) {\n        if (isServer || !(portal.current instanceof HTMLElement))\n            return;\n        var customEvent = createCustomEvent(e);\n        if (portal.current.contains(customEvent.target) && onPortalClick)\n            onPortalClick(customEvent);\n        handleOutsideMouseClick(e);\n    }, [handleOutsideMouseClick]);\n    // used to remove the event listeners on unmount\n    var eventListeners = react_1.useRef({});\n    react_1.useEffect(function () {\n        if (isServer)\n            return;\n        if (!(elToMountTo instanceof HTMLElement) || !(portal.current instanceof HTMLElement))\n            return;\n        // TODO: eventually will need to figure out a better solution for this.\n        // Surely we can find a way to map onScroll/onWheel -> scroll/wheel better,\n        // but for all other event handlers. For now this works.\n        var eventHandlerMap = {\n            onScroll: 'scroll',\n            onWheel: 'wheel',\n        };\n        var node = portal.current;\n        elToMountTo.appendChild(portal.current);\n        // handles all special case handlers. Currently only onScroll and onWheel\n        Object.entries(eventHandlerMap).forEach(function (_a) {\n            var handlerName = _a[0] /* onScroll */, eventListenerName = _a[1] /* scroll */;\n            if (!eventHandlers[handlerName])\n                return;\n            eventListeners.current[handlerName] = function (e) { return eventHandlers[handlerName](createCustomEvent(e)); };\n            document.addEventListener(eventListenerName, eventListeners.current[handlerName]);\n        });\n        document.addEventListener('keydown', handleKeydown);\n        document.addEventListener('mousedown', handleMouseDown);\n        return function () {\n            // handles all special case handlers. Currently only onScroll and onWheel\n            Object.entries(eventHandlerMap).forEach(function (_a) {\n                var handlerName = _a[0], eventListenerName = _a[1];\n                if (!eventHandlers[handlerName])\n                    return;\n                document.removeEventListener(eventListenerName, eventListeners.current[handlerName]);\n                delete eventListeners.current[handlerName];\n            });\n            document.removeEventListener('keydown', handleKeydown);\n            document.removeEventListener('mousedown', handleMouseDown);\n            elToMountTo.removeChild(node);\n        };\n    }, [isServer, handleOutsideMouseClick, handleKeydown, elToMountTo, portal]);\n    var Portal = react_1.useCallback(function (_a) {\n        var children = _a.children;\n        if (portal.current != null)\n            return react_dom_1.createPortal(children, portal.current);\n        return null;\n    }, [portal]);\n    return Object.assign([openPortal, closePortal, open.current, Portal, togglePortal, targetEl, portal], __assign(__assign({ isOpen: open.current, openPortal: openPortal, ref: targetEl, closePortal: closePortal,\n        togglePortal: togglePortal,\n        Portal: Portal, portalRef: portal }, customEventHandlers), { bind: __assign({ ref: targetEl }, customEventHandlers) }));\n}\nexports.default = usePortal;\n//# sourceMappingURL=usePortal.js.map"]},"metadata":{},"sourceType":"script"}